<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.css"
            rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
            href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
            rel="stylesheet"
    />
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- jQuery UI -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <style>
        .navbar {
            background-color: #fad9f3;
        }
        body{
            background-color: #f5e9f2;
        }

        .container{
            margin-top: 80px;
            width: 35%;
            border: 2px #d4b8ee solid;
            box-shadow: 20px 20px 40px 10px rgb(240, 201, 208) ;
            padding: 30px;
            background-color: #e4dfe4;
        }
    </style>

    <title>Login</title>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <i class='fas fa-building' style='font-size:40px;color:red'></i>
            Quản Lý Kí Túc Xá
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- <form class="d-flex">
          <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-danger btn-rounded" type="submit">Search</button>
        </form> -->
    </div>
</nav>

<div class="container">
    <!-- Pills navs -->
    <ul class="nav nav-pills nav-justified mb-3" id="ex1" role="tablist">
        <li class="nav-item" role="presentation">
            <a
                    class="nav-link active"
                    id="tab-login"
                    data-mdb-toggle="pill"
                    href="#pills-login"
                    role="tab"
                    aria-controls="pills-login"
                    aria-selected="true"
            >Login</a
            >
        </li>
        <li class="nav-item" role="presentation">
            <a
                    class="nav-link"
                    id="tab-register"
                    data-mdb-toggle="pill"
                    href="#pills-register"
                    role="tab"
                    aria-controls="pills-register"
                    aria-selected="false"
            >Register</a
            >
        </li>
    </ul>
    <!-- Pills navs -->

    <!-- Pills content -->
    <div class="tab-content">
        <div class="tab-pane fade show active" id="pills-login" role="tabpanel" aria-labelledby="tab-login">
            <form >
                <div class="text-center mb-3">
                    <p>Sign in with:</p>
                    <button type="button" class="btn btn-secondary btn-floating mx-1">
                        <i class="fab fa-facebook-f"></i>
                    </button>

                    <button type="button" class="btn btn-secondary btn-floating mx-1">
                        <i class="fab fa-google"></i>
                    </button>

                    <button type="button" class="btn btn-secondary btn-floating mx-1">
                        <i class="fab fa-twitter"></i>
                    </button>

                    <button type="button" class="btn btn-secondary btn-floating mx-1">
                        <i class="fab fa-github"></i>
                    </button>
                </div>

                <p class="text-center">or:</p>

                <div class="form-outline mb-4">
                    <input type="text" id="username" class="form-control"  name="username" />
                    <label class="form-label" for="username" >Username</label>
                </div>

                <div class="form-outline mb-4">
                    <input type="password" id="password" class="form-control"  name="password" />
                    <label class="form-label" for="password">Password</label>
                </div>

                <!-- 2 column grid layout -->
                <div class="row mb-4">
                    <div class="col-md-6 d-flex justify-content-center">
                        <!-- Checkbox -->
                        <div class="form-check mb-3 mb-md-0">
                            <input class="form-check-input" type="checkbox" value="" id="loginCheck" checked />
                            <label class="form-check-label" for="loginCheck"> Remember me </label>
                        </div>
                    </div>

                    <div class="col-md-6 d-flex justify-content-center">
                        <!-- Simple link -->
                        <a href="#!">Forgot password?</a>
                    </div>
                </div>

                <!-- Submit button -->
                <button type="submit" class="btn btn-primary btn-block mb-4" onclick="login()">Sign in</button>

                <!-- Register buttons -->
                <div class="text-center">
                    <p>Not a member? <a href="#!">Register</a></p>
                </div>
            </form>
        </div>
        <div class="tab-pane fade" id="pills-register" role="tabpanel" aria-labelledby="tab-register">
            <form>
                <div class="text-center mb-3">
                    <p>Sign up with:</p>
                    <button type="button" class="btn btn-secondary btn-floating mx-1">
                        <i class="fab fa-facebook-f"></i>
                    </button>

                    <button type="button" class="btn btn-secondary btn-floating mx-1">
                        <i class="fab fa-google"></i>
                    </button>

                    <button type="button" class="btn btn-secondary btn-floating mx-1">
                        <i class="fab fa-twitter"></i>
                    </button>

                    <button type="button" class="btn btn-secondary btn-floating mx-1">
                        <i class="fab fa-github"></i>
                    </button>
                </div>

                <p class="text-center">or:</p>

                <!-- MaSinhVien input -->
                <div class="form-outline mb-4">
                    <input type="text" id="registermaSinhVien" class="form-control" name="maSinhVien" oninput="validateStudentID(this)" />
                    <label class="form-label" for="registermaSinhVien"> Mã Sinh Viên</label>
                </div>

                <script>
                    function validateStudentID(input) {
                        // Remove any non-alphanumeric characters
                        input.value = input.value.replace(/[^a-zA-Z0-9]/g, '');
                    }
                </script>

                <!-- HoTen input -->
                <div class="form-outline mb-4">
                    <input type="text" id="registerHoTen" class="form-control" name="hoTen" />
                    <label class="form-label" for="registerHoTen">Họ Tên</label>
                </div>

                <div class="form-outline mb-4">
                    <input type="text" id="registerNgaySinh" class="form-control" name="ngaySinh"/>
                    <label class="form-label" for="registerNgaySinh">Ngày Sinh</label>
                </div>

                <!-- CCCD input -->
                <div class="form-outline mb-4">
                    <input type="number" id="registerCCCD" class="form-control" name="cccd" />
                    <label class="form-label" for="registerCCCD">Căn Cước CCCD</label>
                </div>
                <!-- Giới Tính dropdown -->
                <div >
                    <label class="form-label" for="registerGioiTinh">  Giới Tính</label>
                    <select class="form-select" id="registerGioiTinh" name="gioiTinh">
                        <option value="Nam">Nam</option>
                        <option value="Nu">Nữ</option>
                    </select>

                </div>
                <br>
                <!-- SoDienThoai input -->
                <div class="form-outline mb-4">
                    <input type="number" id="registerSoDienThoai" class="form-control" name="soDienThoai"/>
                    <label class="form-label" for="registerSoDienThoai">Số Điện Thoại</label>
                </div>
                <!-- DiaChi input -->
                <div class="form-outline mb-4">
                    <input type="text" id="registerDiaChi" class="form-control" name="diaChi"/>
                    <label class="form-label" for="registerDiaChi">Địa Chỉ</label>
                </div>
                <!-- email input -->
                <div class="form-outline mb-4">
                    <input type="email" id="registerEmail" class="form-control" name="email"/>
                    <label class="form-label" for="registerEmail">Email</label>
                </div>

                <!-- Checkbox -->
                <div class="form-check d-flex justify-content-center mb-4">
                    <input
                            class="form-check-input me-2"
                            type="checkbox"
                            value=""
                            id="registerCheck"
                            checked
                            aria-describedby="registerCheckHelpText"
                    />
                    <label class="form-check-label" for="registerCheck">
                        I have read and agree to the terms
                    </label>
                </div>

                <!-- Submit button -->
                <button type="submit" class="btn btn-primary btn-block mb-3" onclick="register()">Register</button>
            </form>
        </div>
    </div>
    <!-- Pills content -->
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script
        type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.js"
></script>
<script>
    $(function () {
        // Lấy ngày hiện tại
        var currentDate = new Date();

        // Kích hoạt Datepicker và thiết lập ngày tháng năm
        $("#registerNgaySinh").datepicker({
            dateFormat: 'yy-mm-dd',
            changeMonth: true,
            changeYear: true,
            showButtonPanel: true,
            maxDate: currentDate,  // Đặt maxDate để ngăn chọn ngày lớn hơn ngày hiện tại
            beforeShow: function (input, inst) {
                // Lấy năm hiện tại
                var currentYear = new Date().getFullYear();

                // Tính năm bắt đầu cho dropdown (100 năm trước)
                var startYear = currentYear - 100;

                // Tạo danh sách năm
                var yearList = [];
                for (var i = 0; i < 100; i++) {
                    yearList.push(startYear + i);
                }

                // Đặt danh sách năm cho dropdown
                $(this).datepicker('option', 'yearRange', yearList[0] + ':' + yearList[yearList.length - 1]);
            }
        });
    });

</script>

<script>


    function login(){
        this.event.preventDefault();
        let login = {};
        login['username'] = $('#username').val();
        login['password'] = $('#password').val();


        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "post",
            contentType: 'application/json',
            data: JSON.stringify(login),
            url: "http://localhost:8080/api/login",
            success: (response) => {
                console.log(response);
                localStorage.setItem("token", response.jwtToken);

                if (typeof response === 'string') {
                    console.log(response);
                    alert("Đang chờ duyệt");
                } else {
                    console.log(response);
                    localStorage.setItem("token", response.jwtToken);
                    let role = response.role;

                    if (role === "ROLE_USER") {
                        window.location.href = "home";
                    }
                    if (role === "ROLE_ADMIN") {
                        window.location.href = "admin";
                    }
                }
            },
            error: (e) => {
                console.log(e);
                alert("Login fail, Wrong password")
            }

        });
    }

    function register() {
        this.event.preventDefault();
        let register = {};
        register['maSinhVien'] = $('#registermaSinhVien').val();
        register['hoTen'] = $('#registerHoTen').val();
        register['ngaySinh'] = $('#registerNgaySinh').val();
        register['cccd'] = $('#registerCCCD').val();
        register['gioiTinh'] = $('#registerGioiTinh').val();
        register['soDienThoai'] = $('#registerSoDienThoai').val();
        register['diaChi'] = $('#registerDiaChi').val();
        register['email'] = $('#registerEmail').val();
        register['trangThai'] = "Chờ duyệt";
        register['soPhong'] = "";
        //register['nguoiDung']=2;
        $.ajax({
            url: "http://localhost:8080/api/register",
            headers: {
                'Accept': 'application/json',
            },
            type: "Post",
            data: JSON.stringify(register),
            contentType: 'application/json',
            dataType: 'json',
            success: (response) => {
                if (response.status === "error") {
                    console.log(response.message);
                    alert("Đăng kí thất bại: " + response.message);
                } else if (response.status === "success") {
                    console.log(response.message);
                    alert("Đăng kí thành công");
                } else {
                    console.log("Unknown response:", response);
                }
            }

        });
    }
</script>
</body>
</html>
</body>
</html>